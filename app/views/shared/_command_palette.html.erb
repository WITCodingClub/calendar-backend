<!-- Command Palette Modal -->
<div data-controller="command-palette"
     data-command-palette-target="modal"
     data-action="click->command-palette#closeOnBackdrop"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center pt-[20vh] z-50 hidden">

  <div data-action="click->command-palette#stopPropagation" class="bg-white rounded-lg shadow-xl w-full max-w-lg mx-4 overflow-hidden">
    <!-- Search Input -->
    <div class="p-4 border-b border-gray-200">
      <input data-command-palette-target="input"
             data-action="input->command-palette#filter keydown->command-palette#navigate"
             type="text"
             placeholder="Search navigation..."
             class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#d13732] focus:border-transparent">
    </div>

    <!-- Navigation Items -->
    <div data-command-palette-target="results" class="max-h-80 overflow-y-auto">
      <% Admin::NavigationRegistry.categories_for_user(current_user).each do |category| %>
        <% category[:items].each do |item| %>
          <%
            # Determine path
            path = if item[:path].is_a?(Symbol)
              begin
                send(item[:path])
              rescue StandardError
                nil
              end
            else
              item[:path]
            end

            next if path.nil?
          %>

          <div data-command-palette-target="item"
               data-action="click->command-palette#clickItem"
               class="p-3 hover:bg-gray-50 border-b border-gray-100 cursor-pointer">
            <%= link_to path, class: "flex items-center space-x-3 text-gray-900 no-underline" do %>
              <div class="w-8 h-8 bg-<%= item[:color] || 'gray' %>-500 rounded-lg flex items-center justify-center">
                <%= render_icon(item[:icon]) %>
              </div>
              <div class="flex-1">
                <div class="font-medium"><%= item[:label] %></div>
                <% if item[:description] %>
                  <div class="text-sm text-gray-500"><%= item[:description] %></div>
                <% end %>
              </div>
              <% if category[:id] != :overview %>
                <div class="text-xs text-gray-400 uppercase"><%= category[:label] %></div>
              <% end %>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- Footer -->
    <div class="px-4 py-3 bg-gray-50 border-t border-gray-200 text-xs text-gray-500">
      <div class="flex items-center justify-between">
        <span>Use ↑↓ to navigate</span>
        <span><kbd class="px-2 py-1 bg-white border border-gray-300 rounded text-xs">ESC</kbd> to close</span>
      </div>
    </div>
  </div>
</div>
